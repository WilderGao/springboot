<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wilder.safe.dao.UserDao">
    <select id="selectUserById" resultType="com.qg.springboot.shiro.model.User">
        SELECT * FROM user
        WHERE user.id = #{id}
    </select>

    <select id="getUserByAccount" resultType="com.wilder.safe.model.User">
        SELECT * FROM user
        WHERE user.account = #{account}
    </select>

    <select id="getRolesByUserId" resultType="com.wilder.safe.model.Role">
        SELECT role_id AS roleId,
        role_name AS roleName
        FROM role
        WHERE role_id IN (
          SELECT role_id FROM user_role
          WHERE user_id = #{userId}
        )
    </select>

    <select id="getPermissionByRoleId" resultType="com.wilder.safe.model.Permission">
        SELECT permission_id AS permissionId,
        permission_name AS permissionName
        FROM permission
        WHERE permission_id IN (
          SELECT permission_id FROM role_permission
          WHERE role_id = #{roleId}
        )
    </select>

    <select id="getAllMembers" resultType="com.wilder.safe.model.User">
        SELECT user_id AS userId,
        name AS name,
        account AS account,
        email AS email
        FROM user
        ORDER BY userId ASC
    </select>

    <insert id="addUser" parameterType="com.wilder.safe.model.User">
        INSERT INTO user
        (name, password, email, account)
         VALUES
        (#{u.name}, MD5(MD5(#{u.password})), #{u.email}, #{u.account})
    </insert>
</mapper>